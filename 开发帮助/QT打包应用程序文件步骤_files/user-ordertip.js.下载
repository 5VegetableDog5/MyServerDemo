"use strict";!function(e,n,t){function o(e,n){if(!D||!B[e])return"";var t={};return t.spm=D+"."+B[e],t.extra=JSON.stringify(I.spmExt),void 0!==n&&(t.index=n+1),JSON.stringify(t).replace(/"/g,"&quot;")}function i(){for(var e={},n=0;n<arguments.length;n++)t.extend(!0,e,arguments[n]);return e}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,o=n.createElement("div");o.innerHTML=e,o.style.cssText="min-width:124px;padding:0 8px;opacity: 0.8;height: 40px;background:rgba(34,34,38,1);color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 35%;left:50%;transform: translateX(-50%);z-index: 999999;font-size: 16px;",n.getElementById("user-ordertip-cknow-v2").appendChild(o),setTimeout(function(){o.style.webkitTransition="-webkit-transform 0.5s ease-in, opacity 0.5s ease-in",o.style.opacity="0",setTimeout(function(){n.getElementById("user-ordertip-cknow-v2")&&n.getElementById("user-ordertip-cknow-v2").removeChild(o)},500)},t)}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,n='\n      <div class="loading_warp" id="user-ordertip-loading">\n        <div class="icon_box">\n          <img class="rotating" src="'+x+'/icon-paying.png"/>\n        </div>\n        <div class="pay_msg">查询中...</div>\n      </div>\n    ';t(".ordertip_dialog").append(n).find(".ordertip_content").addClass("noScroll"),setTimeout(function(){t("#user-ordertip-loading").remove(),t(".ordertip_dialog .ordertip_content").removeClass("noScroll")},e)}function a(){var e=c("api_env")||"",n="https://mall.csdn.net/",t=/^beta|test|loc[a-z]*/;return e.match(t)?n="https://test-mall.csdn.net/":e.match(/^pre-|pre[a-z]*/)&&(n="https://pre-mall.csdn.net/"),n}function c(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(n);return null!=t?unescape(t[2]):""}function d(e,o){QRCode?o.pay_url&&(U.priceInfo=o,t("#ordertip_qr_code").html(""),t("#ordertip_notify").hide(),t("#pay_btn").attr("href",o.pay_url),new QRCode(n.getElementById("ordertip_qr_code"),{text:o.pay_url,width:116,height:116}),t("#user-ordertip-cknow-v2 .other_pay").removeClass("none").find("a").attr("href",o.pay_url)):void 0}function l(){f("pay_error","获取失败,点击重试","code_2")}function p(){f("pay_time_out","点击重新获取","")}function u(){f("pay_error","已扫码<br>请在手机端操作","")}function g(e){var n=!(!1===U.show_params.needLoading),t=U.show_params.successProcess||"reload";n&&r(),setTimeout(function(){s("支付成功","1000"),setTimeout(function(){C?(U.close(),C(e)):"reload"===t?window.location.reload():"jump"===t&&(window.location.href=_(e))},1e3)},n?1500:0)}function _(e){return"success"===e.errorMessage&&e.jumpUrl&&1===e.status?e.jumpUrl:!e.need_third_pay&&e.paySuccessUrl?e.paySuccessUrl:"https://mall.csdn.net/myorder"}function f(e,n,o){t("#ordertip_notify").show().html('<img class="pay_icon" src="https://csdnimg.cn/release/download/images/'+e+'.png"/><span class="pay_tip">'+n+"</span>"),t("#ordertip_qr_code").html('<img src="https://csdnimg.cn/public/static/img/csdn-userimg250.gif" width="145" height="145"/>'),"pay_time_out"==e||"pay_error"==e?t("#ordertip_notify .pay_icon,#ordertip_notify .pay_tip").on("click",function(){U.getPayCode()}):t("#ordertip_notify .pay_icon,#ordertip_notify .pay_tip").off("click")}function v(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=0;n<e.length;n++){var t=e[n];if("CKNOW"===t.bizType&&"ORDINARY"===t.vipType)return t.endTime||""}return""}function h(e){var n=new Date(e);return n.getFullYear()+"年"+(n.getMonth()+1)+"月"+n.getDate()+"日"}function m(e){if(!e)return!1;var n=new Date,t=new Date(e),o=t.getTime()-n.getTime();return Math.floor(o/864e5)>=365}function y(){this.userInfo={},this.vipExpireDate="",this.goodsInfo={},this.goodsList=[],this.activeGoodsId="",this.isUseBalance=!0,this.currentIndex=1,this.priceInfo={},this.errType="",this.reportExt={},this.spmExt={},this.navList=[],this.payMethods=[],this.price=0,this.payUrl="",this.params={},this._cart=null,this.show_params={},this.vipRightsObj={},this.defaultInfo=[{name:"30",price:"39.90"},{name:"360",price:"159.00"}],I=this}function b(){U.close()}var w="https://g.csdnimg.cn/user-ordertip/",x=w+"5.0.3_so_v2/images",I=null,k=!1,C=null,T="",E=!0,D="",B={tab1:"3001.9858",tab2:"3001.9859",goodsMonth:"3001.10061",goodsYear:"3001.10062",closeBtn:"3001.10063",rule:"3001.9891",rights:"3001.9860"};try{var j=t("meta[name=report]");D=JSON.parse(j.attr("content")||"{}").spm}catch(e){void 0}var P=function(e){var t=n.cookie;return t&&function(){var n,o={};t=t.split("; ");for(var i=0,s=t.length;i<s&&(n=t[i].split("="),!(n.length>0&&(n[0]===e&&(o.key=n[0],o.value=n[1],o.status=!0),"key"in o)));i++);return"key"in o&&o}()};!function(e){var t=n.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,n.getElementsByTagName("head")[0].appendChild(t)}("https://g.csdnimg.cn/user-ordertip/5.0.3_so_v2/user-ordertip.css");y.prototype={constructor:y,close:function(){k=!1,this._cart&&this._cart.clearTimer(),t("#user-ordertip-box").remove()},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return P("UserName").value?window.csdn.cart?window.csdn.cartClass?(this.show_params=e,"function"==typeof e.get_pay_success_callback&&(C=e.get_pay_success_callback),this.sale=e.sale_source||c("sale_source"),this.reportExt=e.report_ext||{},this.spmExt=e.spmExt||{},this.init(),void this.reportDialogView()):void void 0:void void 0:void void 0},reportDialogView:function(){try{window.csdn.report&&window.csdn.report.reportView({spm:"3001.10060",extra:JSON.stringify(this.spmExt||{})})}catch(e){void 0}},init:function(){this._cart=new window.csdn.cartClass,this.getVipGoodsList(function(e){I.getGoodsInfo(e,function(e){I.goodsInfo=e,I.goodsCodeData(e.new_price,e.available_amount),I.activeGoodsId=I.goodsInfo.goods_id,I.initDialog(),I.getVipRights(),I.getUserInfo(),I.getPayCode()},!1)})},bindEvents:function(){t(n).off("click",".ordertip_dialog .user_balance").on("click",".ordertip_dialog .user_balance",function(){if(t(".ordertip_dialog .user_balance").hasClass("disable"))return void(I.isUseBalance=!1);t(".ordertip_dialog .user_balance").hasClass("active")?(t(".ordertip_dialog .user_balance").removeClass("active"),I.isUseBalance=!1):(t(".ordertip_dialog .user_balance").addClass("active"),I.isUseBalance=!0),I.getGoodsInfo(I.goodsInfo,function(e){I.goodsInfo=e,I.goodsCodeData(I.goodsInfo.new_price,I.goodsInfo.available_amount),I.changePriceHtml(I.price),I.getPayCode(I.goodsInfo)})}),t(n).off("click","#pay_btn").on("click","#pay_btn",function(e){var n=P("UserName").value;if(E){E=!1;var o={product_id:I.goodsInfo.product_id,goods_id:I.goodsInfo.goods_id,flag:I.goodsInfo.flag,goodsSource:I.goodsInfo.goodsSource||"",is_use_balance:2,sale_source:I.sale,request_id:n+"_"+T+"_"+I.goodsInfo.product_id+"_"+I.goodsInfo.goods_id+"_"+I.goodsInfo.flag};return void I._cart.quickBuy({params:o,get_pay_success_callback:function(e){E=!0,200==e.code&&!1===e.data.need_third_pay&&g(e.data)},error_function:function(e){E=!0,400103012==e.status&&t(".ordertip_item.active").trigger("click"),void 0}})}}),t(n).on("click",".ordertip_header_btn",function(e){I.close()}),t(n).off("click",".ordertip_item").on("click",".ordertip_item",function(e){var n=JSON.parse(t(this).attr("data-goods")||"{}"),o="";if(I.currentIndex=n.index,n=i(n,I.goodsList[n.index].ext),!t(this).hasClass("active"))return o=1===I.currentIndex?x+"/benefits.png":x+"/benefits-gray.png",t(".discount_bg").attr("src",o),t(this).addClass("active").siblings().removeClass("active"),void I.getGoodsInfo(n,function(e){I.goodsInfo=e,1==I.goodsInfo.isContract&&e.available_amount>e.new_price?(I.isUseBalance=!1,I.goodsInfo.hideBalance=!0):e.available_amount>0&&(I.isUseBalance=!0),I.activeGoodsId=e.goods_id,I.goodsCodeData(e.new_price,e.available_amount),t(".ordertip_dialog .commodity_box").html("").append(I.setPayPriceHtml()),t(".ordertip_dialog .scan_code").html("").append(I.setPaylistHtml()),t(".content_left .content").html("").append(I.setBenefitsHtml(1===I.currentIndex?"year":"month"))})})},initDialog:function(){this.bindEvents(),this.renderDialog()},setUserInfoHtml:function(){var e="";return I.userInfo.nickname?(e=I.vipExpireDate.toString().length>0?h(I.vipExpireDate)+"到期":"未订阅C知道专属服务",'<div class="ordertip_user">\n          <div class="left-area">\n            <img class="ordertip_user_head" src="'+I.userInfo.avatar+'" />\n            <div class="ordertip_user_info">\n              <div class="ordertip_user_name '+(4==I.userInfo.userStatus?"vip":"")+'">'+I.userInfo.nickname+'</div>\n              <div class="ordertip_user_vipdesc">'+e+'</div>\n            </div>\n          </div>\n          <div class="ordertip_intro">\n            欢迎订阅C知道专属服务\n            <img src="'+x+'/Vector.png"></img>\n          </div>\n        </div>'):""},setGoodsListHtml:function(){var e=this,n="",t="";return this.goodsList.slice(0,2).forEach(function(i,s){n=0===s?"goodsMonth":"goodsYear",t+='<div data-report-click="'+o(n)+'" class="ordertip_c_l_goodsitem ordertip_item '+(e.activeGoodsId==i.ext.goodsId?"active":"")+"\" data-id='"+i.ext.goodsId+"' data-goods='"+JSON.stringify({index:s,type:"other"})+'\'>\n          <div class="ordertip_c_l_b_body">\n            <div class="ordertip_c_l_b_price"> \n              <p class="price_day">'+(i.ext.activityContent||30)+'</p>\n              <span class="price_daily">≈￥'+(i.ext.unitPrice||e.defaultInfo[s].name)+'/天</span>\n              <div class="price_amount">\n                <span>￥</span>'+(i.ext.originalPrice||e.defaultInfo[s].price)+'\n              </div>\n            </div>\n          </div>\n          <img class="discount_bg" src="'+x+'/benefits.png"></img>\n          <img class="normal_bg" src="'+x+'/normal.png"></img>\n        </div>'}),t},setPaylistHtml:function(){var e=I.goodsInfo,n=[];e.payTypeList&&e.payTypeList.forEach(function(e){"unionpay"!==e.name&&n.push(e)});for(var t="",o=0;o<n.length;o++)t+='<img class="icon_item '+n[o].name+'" src='+JSON.stringify(n[o].image)+' alt="img">';return t+'<span class="pay_intro">扫码支付</span>'},setPayPriceHtml:function(){var e=I.goodsInfo;return'<ul class="commodity_desc">\n                    <li class="amount_actually">\n                      实付：<span class="pre">￥</span><span class="num">'+I.price+'</span>\n                    </li>\n                    <li class="discount_num '+(e.totalDiscountPrice>0?"":"none")+'">\n                      <span>已优惠'+e.totalDiscountPrice+'元!</span>\n                    </li>\n                    \n                    <li class="gift none '+(e.discount_msg?"block":"none")+'">\n                      <img src="'+x+'/enjoy.png" alt="">\n                      <span>'+e.discount_msg+'</span>\n                    </li>\n\n                    <li class="user_balance '+(e.hideBalance?"none":"")+" "+(e.available_amount>0?I.isUseBalance?"active":"":"disable")+" "+(19===e.flag?"none":"")+'" >\n                      <span class="unchecked"></span>\n                      <img src="'+x+'/checked.png" alt="" class="checked">\n                      钱包余额 <b class="num">'+e.available_amount+'</b>\n                    </li>\n                    <li class="user_balance tips '+(e.hideBalance?"":"none")+'">\n                      连续包月暂不支持余额抵扣，请使用微信或支付宝付款，请您谅解！\n                    </li>\n                  </ul>'},setBenefitsHtml:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"year";return I.vipRightsObj[e]&&0!==I.vipRightsObj[e].length?'<p>服务尊享权益</p><div class="lists">'+I.vipRightsObj[e].reduce(function(e,n){return e+='\n          <div class="list-item">\n            <img src="'+x+"/"+n.icon+'.png"></img>\n            <span>'+n.message+"</span>\n          </div>\n        "},"")+'</div><p class="bottom">更多权益陆续增加中...</p>':""},setUserTipHtml:function(){var e=h(I.vipExpireDate);return'<div class="notice">\n        <img src="'+x+'/volume-high.png"></img>\n        你的C知道服务权益到期时间为'+e+"，请理性消费～\n      </div>"},renderDialog:function(){this.createMask();var n=this.setGoodsListHtml(),i=this.setPaylistHtml(),s=this.setPayPriceHtml(),r='<div id="user-ordertip-cknow-v2" class="user-ordertip-cknow-v2 noselect">\n          <div class="ordertip_dialog">\n              <div class="ordertip_header" style="background: url('+x+'/bg.png) center / 100% 100% no-repeat">\n                <span data-report-click="'+o("closeBtn")+'" class="ordertip_header_btn"> + </span>\n              </div>\n              <div class="ordertip_content">\n                <div class="content_left">\n                  <div class="ordertip_c_benefits">\n                    <div class="header">\n                      <img class="logo" src="'+x+'/logo.png"></img>\n                      <p>C知道</p>\n                      <img class="bottom_line" src="'+x+'/line.png"></img>\n                    </div>\n                    <section class="content"></section>\n                  </div>\n                </div>\n                <div class="content_right">\n                  <div class="right_container">\n                    <p class="container-title">服务时长</p>\n                    <div class="ordertip_c_goodslist">\n                      '+n+'\n                    </div>\n                    <p style="margin-top: 24px">扫码支付</p>\n                    <div class="ordertip_paybox">\n                      <div class="recharge_mode '+(0!=I.price?"block":"none")+'">\n                        <div class="recharge_mode_qr_code" id="ordertip_qr_code">\n                          <img class="loading" src="'+x+'/loading.gif" width="50" height="50">\n                        </div>\n                        <div id="ordertip_notify" class="pay_notify"></div>\n                        <p class="scan_code">\n                          '+i+'\n                        </p>\n                      </div>\n                      <div class="commodity_box">\n                        '+s+'\n                      </div>\n                      <div class="recharge_mode_btn '+(0==I.price?"block":"none")+'">\n                        <div class="pay_btn" id="pay_btn">确定支付</div>\n                      </div>\n                    </div>\n                      \n                  </div>\n                  <div class="ordertip_agreement">\n                    购买即同意<a data-report-click="'+o("rule")+'" href="https://marketing.csdn.net/p/5e32df9d30e5c6ce57513adabe397221" target="_blank">《C知道服务协议》</a>\n                  </div>\n                </div>\n              </div>\n            </div>\n          <div class="ordertip_mask"></div>\n      </div>\n      ',a=t(r);t("#user-ordertip-box").append(a),e.report&&window.csdn.report.viewCheck()},createMask:function(){var e=n.createElement("div");e.id="user-ordertip-box",n.body.appendChild(e)},getVipGoodsList:function(e){t.ajax({url:a()+"mp/mallorder/api/internal/goods/showListV2?showType=cknowvip",type:"GET",contentType:"application/json",xhrFields:{withCredentials:!0},success:function(n){n.data?(I.goodsList=n.data.cknowvip||[],e&&e(I.findDefaultGood(I.goodsList))):void 0},error:function(e){void 0}})},getGoodsInfo:function(e,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.ext&&delete e.ext,t.ajax({url:a()+"mp/mallorder/api/internal/goods/getGoodsInfo",type:"GET",dataType:"json",data:i(e,{goods_id:e.goodsId,product_id:e.productId}),contentType:"application/json",xhrFields:{withCredentials:!0},success:function(e){200==e.code&&e.data?(19===e.data.flag&&(I.isUseBalance=!1),n&&n(e.data),I.changePriceHtml(I.price),o&&I.getPayCode(e.data)):void 0},error:function(e){void 0}})},getVipRights:function(){Object.keys(I.vipRightsObj).length>0||t.ajax({url:"https://cms-api.csdn.net/v1/web_home/select_content?componentIds=cknow-permission-obj",type:"GET",xhrFields:{withCredentials:!0},headers:{"Content-Type":"application/json"},success:function(e){if(e.data){var n=e.data;I.vipRightsObj=n["cknow-permission-obj"].info||[],t(".ordertip_content .content_left .content").html("").append(I.setBenefitsHtml())}else void 0},error:function(e){void 0}})},getUserInfo:function(){t.ajax({url:a()+"mp/mallorder/vip_plugin/vip_buy/get_user_info",type:"GET",contentType:"application/json",xhrFields:{withCredentials:!0},success:function(e){if(e.data){I.userInfo=e.data,I.vipExpireDate=v(I.userInfo.permissions||[]);var n=m(I.vipExpireDate);t("#user-ordertip-cknow-v2 .ordertip_header")&&t("#user-ordertip-cknow-v2 .ordertip_header").prepend(I.setUserInfoHtml()),n&&(t("#user-ordertip-cknow-v2 .ordertip_content .content_right").prepend(I.setUserTipHtml()),t("#user-ordertip-cknow-v2 .ordertip_content .right_container").css("padding-top","8px"))}else void 0},error:function(e){void 0}})},goodsCodeData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=0;o=this.isUseBalance?e-t-n<0?0:(100*e-100*t-100*n)/100:e-t<0?0:(100*e-100*t)/100,this.price=Number(o).toFixed(2)},changePriceHtml:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Number(e)<=0?(t(".ordertip_dialog .recharge_mode").addClass("none"),t(".ordertip_dialog .recharge_mode_btn").addClass("show").removeClass("none")):(t(".ordertip_dialog .recharge_mode").removeClass("none"),t(".ordertip_dialog .recharge_mode_btn").removeClass("show").addClass("none")),t(".ordertip_dialog .amount_actually .num").html(e)},getPayCode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.goodsInfo,n={product_id:e.product_id,goods_id:e.goods_id,goodsSource:e.goodsSource||"",flag:e.flag,sale_source:I.sale,report_ext:I.reportExt,is_use_balance:Number(I.isUseBalance),coupon_key:e.coupon_key,cash_coupon_keys:e.cash_coupon_keys,use_cache:!0,success_function:d,error_function:l,timeout_function:p,payment_function:u,get_pay_success_callback:g};I._cart.qrPay(n)},findDefaultGood:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=e.find(function(e,n,t){return 1===e.ext.default})||e[0];return i({goods_id:n.ext.goodsId||"",flag:n.ext.flag||"",product_id:n.ext.productId||""},n.ext)}};var U=void 0,G=function(e,n){var t=null;return function(){var o=this,i=arguments;t&&(clearTimeout(t),t=null),t=setTimeout(function(){e.apply(o,i)},n)}}(function(e){void 0,k||(k=!0,T=(new Date).getTime(),U=new y,U.show(e),window._userOrderTip=U)},200);window.csdn.userOrderTipChat={show:G,close:b}}(window.csdn=window.csdn||{},document,jQuery);